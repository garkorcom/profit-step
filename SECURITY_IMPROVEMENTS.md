# üîí –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.

---

## üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ö–†–ò–¢–ò–ß–ù–û)

### 1. ‚úÖ –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–π –ø–∞—Ä–æ–ª—å
**–§–∞–π–ª:** `functions/src/index.ts:327`

**–î–æ:**
```typescript
const tempPassword = Math.random().toString(36).slice(-10) +
                    Math.random().toString(36).slice(-10);
```

**–ü–æ—Å–ª–µ:**
```typescript
import * as crypto from 'crypto';

const tempPassword = crypto.randomBytes(32).toString('hex');
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- `Math.random()` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–º
- –ü–∞—Ä–æ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º–∏ –∏ –≤–∑–ª–æ–º–∞–Ω–Ω—ã–º–∏
- `crypto.randomBytes()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —ç–Ω—Ç—Ä–æ–ø–∏–∏
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 64-—Å–∏–º–≤–æ–ª—å–Ω—ã–π hex –ø–∞—Ä–æ–ª—å (256 –±–∏—Ç —ç–Ω—Ç—Ä–æ–ø–∏–∏)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** üîí –ù–∞–¥–µ–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π

---

### 2. ‚úÖ Email –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
**–§–∞–π–ª:** `src/components/admin/InviteUserDialog.tsx:56-61`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```typescript
// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ email
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
if (!emailRegex.test(email)) {
  setError('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email –∞–¥—Ä–µ—Å–∞');
  return;
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö email –Ω–∞ backend
- –≠–∫–æ–Ω–æ–º–∏—Ç –≤—ã–∑–æ–≤—ã Cloud Functions
- –£–ª—É—á—à–∞–µ—Ç UX (–º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ª–æ–π –∑–∞—â–∏—Ç—ã –ø–µ—Ä–µ–¥ backend –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞

---

### 3. ‚úÖ Rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
**–§–∞–π–ª:** `functions/src/index.ts:358-402`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```typescript
let newUserId: string | null = null;

try {
  // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userRecord = await admin.auth().createUser({...});
  newUserId = userRecord.uid;

  // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
  await db.collection('users').doc(newUserId).set({...});

  // –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞...

  return {...};
} catch (setupError: any) {
  // Rollback: —É–¥–∞–ª—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  if (newUserId) {
    try {
      await admin.auth().deleteUser(newUserId);
      console.log(`üîÑ Rolled back user creation: ${newUserId}`);
    } catch (rollbackError) {
      console.error('‚ö†Ô∏è Failed to rollback:', rollbackError);
    }
  }
  throw setupError;
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "–æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏–µ" Auth –∞–∫–∫–∞—É–Ω—Ç—ã –±–µ–∑ –ø—Ä–æ—Ñ–∏–ª–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** üéØ –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–í–ê–ñ–ù–û)

### 4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã email
**–§–∞–π–ª:** `functions/src/index.ts:340-352`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```typescript
// 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email
const existingUsersQuery = await db
  .collection('users')
  .where('email', '==', email.toLowerCase())
  .where('companyId', '==', companyId)
  .get();

if (!existingUsersQuery.empty) {
  throw new functions.https.HttpsError(
    'already-exists',
    `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å email ${email} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏`
  );
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
- –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è –≤ Auth (—ç–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤)
- –£–ª—É—á—à–∞–µ—Ç UX

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ú® –ù–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

### 5. ‚úÖ Rate Limiting (10 –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π/—á–∞—Å)
**–§–∞–π–ª:** `functions/src/index.ts:325-338, 387-394`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```typescript
// 3. Rate Limiting
const oneHourAgo = admin.firestore.Timestamp.fromMillis(Date.now() - 3600000);
const recentInvitesQuery = await db
  .collection('invitations')
  .where('invitedBy', '==', adminUid)
  .where('createdAt', '>', oneHourAgo)
  .get();

if (recentInvitesQuery.size >= 10) {
  throw new functions.https.HttpsError(
    'resource-exhausted',
    '–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π (–º–∞–∫—Å–∏–º—É–º 10 –≤ —á–∞—Å). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'
  );
}

// ...–ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è...

// 7. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–ª—è rate limiting
await db.collection('invitations').add({
  invitedBy: adminUid,
  invitedEmail: email.toLowerCase(),
  invitedUserId: newUserId,
  companyId: companyId,
  createdAt: admin.firestore.FieldValue.serverTimestamp(),
});
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞/–∞–±—É–∑–∞
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Ç–∞–∫–∏
- –õ–∏–º–∏—Ç–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–º –æ–ø–µ—Ä–∞—Ü–∏—è–º
- –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ/–∑–ª–æ–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```typescript
// –ö–æ–ª–ª–µ–∫—Ü–∏—è: invitations
{
  invitedBy: string;        // UID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  invitedEmail: string;     // Email –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ
  invitedUserId: string;    // UID –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  companyId: string;        // ID –∫–æ–º–ø–∞–Ω–∏–∏
  createdAt: Timestamp;     // –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** üö´ –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∏ –∞–±—É–∑–∞

---

### 6. ‚úÖ Cleanup —Ç–∞–π–º–µ—Ä–æ–≤ –≤ React
**–§–∞–π–ª:** `src/components/admin/InviteUserDialog.tsx:47-60, 114-123`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```typescript
import React, { useState, useEffect } from 'react';

// Cleanup —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
useEffect(() => {
  let timerId: NodeJS.Timeout;

  if (copySuccess) {
    timerId = setTimeout(() => setCopySuccess(false), 2000);
  }

  return () => {
    if (timerId) {
      clearTimeout(timerId);
    }
  };
}, [copySuccess]);

// –í handleCopyLink —É–±—Ä–∞–Ω setTimeout
const handleCopyLink = async () => {
  try {
    await navigator.clipboard.writeText(passwordResetLink);
    setCopySuccess(true);
    // –¢–∞–π–º–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ useEffect
  } catch (err) {
    console.error('Failed to copy link:', err);
    setError('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É');
  }
};
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
- –ò–∑–±–µ–≥–∞–µ—Ç –ø–æ–ø—ã—Ç–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- React best practice
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** üßπ –ß–∏—Å—Ç—ã–π –∫–æ–¥ –±–µ–∑ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —É–ª—É—á—à–µ–Ω–∏–π

| # | –£–ª—É—á—à–µ–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª |
|---|-----------|-----------|--------|------|
| 1 | Crypto.randomBytes() | üî¥ –í—ã—Å–æ–∫–∏–π | ‚úÖ –ì–æ—Ç–æ–≤–æ | functions/src/index.ts |
| 2 | Email –≤–∞–ª–∏–¥–∞—Ü–∏—è | üî¥ –í—ã—Å–æ–∫–∏–π | ‚úÖ –ì–æ—Ç–æ–≤–æ | InviteUserDialog.tsx |
| 3 | Rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ | üî¥ –í—ã—Å–æ–∫–∏–π | ‚úÖ –ì–æ—Ç–æ–≤–æ | functions/src/index.ts |
| 4 | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ | üü° –°—Ä–µ–¥–Ω–∏–π | ‚úÖ –ì–æ—Ç–æ–≤–æ | functions/src/index.ts |
| 5 | Rate Limiting | üü° –°—Ä–µ–¥–Ω–∏–π | ‚úÖ –ì–æ—Ç–æ–≤–æ | functions/src/index.ts |
| 6 | Cleanup —Ç–∞–π–º–µ—Ä–æ–≤ | üü° –°—Ä–µ–¥–Ω–∏–π | ‚úÖ –ì–æ—Ç–æ–≤–æ | InviteUserDialog.tsx |

---

## üéØ –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∏—Å—Ç–µ–º—É

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–µ –ø–∞—Ä–æ–ª–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç spam/abuse
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ Rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- ‚úÖ –ù–µ—Ç "–æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏—Ö" –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ Cloud Functions
- ‚úÖ –†–∞–Ω–Ω—è—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

### UX
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (email –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

---

## üîç –ù–æ–≤–∞—è Firestore —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ö–æ–ª–ª–µ–∫—Ü–∏—è `invitations`
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è rate limiting:

```typescript
invitations/
  ‚îî‚îÄ‚îÄ {invitationId}
      ‚îú‚îÄ‚îÄ invitedBy: string           // UID –∞–¥–º–∏–Ω–∞
      ‚îú‚îÄ‚îÄ invitedEmail: string        // Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      ‚îú‚îÄ‚îÄ invitedUserId: string       // UID –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      ‚îú‚îÄ‚îÄ companyId: string           // ID –∫–æ–º–ø–∞–Ω–∏–∏
      ‚îî‚îÄ‚îÄ createdAt: Timestamp        // –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
```

**–ò–Ω–¥–µ–∫—Å—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –≤ Firebase Console):**
```
invitations
  ‚îî‚îÄ‚îÄ Composite index:
      - invitedBy (Ascending)
      - createdAt (Descending)
```

---

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –¢–µ—Å—Ç –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –ø–∞—Ä–æ–ª—è
```bash
# –í –ª–æ–≥–∞—Ö Cloud Function –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 64-—Å–∏–º–≤–æ–ª—å–Ω—ã–π hex –ø–∞—Ä–æ–ª—å
firebase functions:log --only inviteUser
# –ü—Ä–∏–º–µ—Ä: "Created user with temp password: a3f2e9d8..."
```

### 2. –¢–µ—Å—Ç email –≤–∞–ª–∏–¥–∞—Ü–∏–∏
1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π email: `test@test`
2. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞: "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email –∞–¥—Ä–µ—Å–∞"
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏ –ø—É—Å—Ç–æ–π email
4. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞: "Email –∏ –∏–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã"

### 3. –¢–µ—Å—Ç rollback
1. –í—Ä–µ–º–µ–Ω–Ω–æ —Å–ª–æ–º–∞–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (–∏–∑–º–µ–Ω–∏—Ç–µ collection –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é)
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: "üîÑ Rolled back user creation: {userId}"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Firebase Auth - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

### 4. –¢–µ—Å—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å email `test@example.com`
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –µ—â–µ –æ–¥–Ω–æ–≥–æ —Å —Ç–µ–º –∂–µ email
3. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å email test@example.com —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"

### 5. –¢–µ—Å—Ç rate limiting
1. –°–æ–∑–¥–∞–π—Ç–µ 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–¥—Ä—è–¥ (–≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞)
2. –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å 11-–≥–æ –¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É:
   "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π (–º–∞–∫—Å–∏–º—É–º 10 –≤ —á–∞—Å)"
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ —á–∞—Å –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

### 6. –¢–µ—Å—Ç cleanup —Ç–∞–π–º–µ—Ä–æ–≤
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí React DevTools
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É
3. –°—Ä–∞–∑—É –∑–∞–∫—Ä–æ–π—Ç–µ –¥–∏–∞–ª–æ–≥ (–Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è "–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞")
4. –í –∫–æ–Ω—Å–æ–ª–∏ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ unmounted component

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π
- ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã "–æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏–µ" Auth –∞–∫–∫–∞—É–Ω—Ç—ã
- ‚ö†Ô∏è –°–ª–∞–±—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ (Math.random)
- ‚ö†Ô∏è –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç spam
- ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã
- ‚ö†Ô∏è –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –≤ React

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π
- ‚úÖ 100% –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–µ –ø–∞—Ä–æ–ª–∏ (256 –±–∏—Ç)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –º–∞–∫—Å 10 –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π/—á–∞—Å
- ‚úÖ 0 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ –∫–æ–º–ø–∞–Ω–∏–∏
- ‚úÖ 0 —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

---

## üîÆ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤ Firestore –¥–ª—è rate limiting
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ rollback —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [ ] –î–æ–±–∞–≤–∏—Ç—å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
- [ ] Dashboard —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
- [ ] –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ª–∏–º–∏—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–ª–∞–Ω–∞)

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [ ] Whitelist IP –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
- [ ] Automated cleanup —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π invitations (> 30 –¥–Ω–µ–π)
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `functions/src/index.ts` - Cloud Function inviteUser
- `src/components/admin/InviteUserDialog.tsx` - UI –¥–∏–∞–ª–æ–≥
- `IMPLEMENTATION_SUMMARY.md` - –û–±—â–∏–π –æ—Ç—á–µ—Ç
- `SECURITY_IMPROVEMENTS.md` - –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
- [Node.js Crypto](https://nodejs.org/api/crypto.html)
- [React useEffect Cleanup](https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup)
- [Firebase Security Rules](https://firebase.google.com/docs/firestore/security/get-started)

---

**–î–∞—Ç–∞:** 2025-11-02
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
**–í–µ—Ä—Å–∏—è:** 2.0.0 (Security Hardened)

---

## ‚ú® –ò—Ç–æ–≥

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ–ø–µ—Ä—å:
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–∞** - –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–µ –ø–∞—Ä–æ–ª–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è
- üõ°Ô∏è **–ó–∞—â–∏—â–µ–Ω–∞** - rate limiting, –∑–∞—â–∏—Ç–∞ –æ—Ç spam
- üéØ **–ù–∞–¥–µ–∂–Ω–∞** - rollback, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞** - —Ä–∞–Ω–Ω—è—è –≤–∞–ª–∏–¥–∞—Ü–∏—è, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- üßπ **–ß–∏—Å—Ç–∞** - –Ω–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏, best practices

**–ì–æ—Ç–æ–≤–æ –∫ production! üéâ**
