# –ú–æ–¥—É–ª—å –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ö–æ–º–∞–Ω–¥–æ–π - Profit Step

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

#### `src/types/user.types.ts`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø `UserStatus` ('active' | 'inactive')
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `UserProfile` —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏:
  - `title?: string` - –î–æ–ª–∂–Ω–æ—Å—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  - `phone?: string` - –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω
  - `dob?: Timestamp | string` - –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
  - `lastSeen?: Timestamp | string` - –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  - `status: UserStatus` - –°—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'active')

### 2. API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### `src/api/userApi.ts` (–û–±–Ω–æ–≤–ª–µ–Ω)
- ‚úÖ `updateLastSeen()` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `createUserProfile()` - –î–æ–±–∞–≤–ª—è–µ—Ç `status: 'active'` –∏ `lastSeen` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

#### `src/api/userManagementApi.ts` (–ù–æ–≤—ã–π)
- ‚úÖ `getCompanyUsers()` - –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
- ‚úÖ `updateUserRole()` - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `updateUserStatus()` - –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å (active/inactive)
- ‚úÖ `uploadUserAvatar()` - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∞–≤–∞—Ç–∞—Ä –≤ Firebase Storage
- ‚úÖ `updateUserExtendedProfile()` - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ `deactivateUser()` / `activateUser()` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º
- ‚úÖ `deleteUserProfile()` - –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏–∑ Firestore

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

#### `src/auth/AuthContext.tsx` (–û–±–Ω–æ–≤–ª–µ–Ω)
- ‚úÖ –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–µ `lastSeen`
- ‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 4. UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### `src/components/admin/UserProfileModal.tsx` (–ù–æ–≤—ã–π)
**–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:**
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –∏–º–µ–Ω–∏
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –í—ã–±–æ—Ä –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è (DatePicker)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Firebase Storage (`avatars/{userId}/profile.jpg`)

#### `src/pages/admin/TeamAdminPage.tsx` (–ù–æ–≤—ã–π)
**–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π (URL: `/admin/team`):**

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∏: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∞–≤–∞—Ç–∞—Ä + –∏–º—è + email), –î–æ–ª–∂–Ω–æ—Å—Ç—å, –†–æ–ª—å, –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥, –°—Ç–∞—Ç—É—Å
- ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ —Ä–æ–ª–∏** —á–µ—Ä–µ–∑ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
- ‚úÖ **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ lastSeen**: "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥", "–≤—á–µ—Ä–∞", –∏ —Ç.–¥. (–∏—Å–ø–æ–ª—å–∑—É—è date-fns)
- ‚úÖ –ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç UserProfileModal)
  - –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å / –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
  - –£–¥–∞–ª–∏—Ç—å (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞" (TODO: –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ Admin)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 5. –†–æ—É—Ç–∏–Ω–≥

#### `src/router/AppRouter.tsx` (–û–±–Ω–æ–≤–ª–µ–Ω)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç `/admin/team`
- ‚úÖ –ó–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ `PrivateRoute`
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ Admin –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

### 6. Cloud Functions

#### `functions/src/index.ts` (–û–±–Ω–æ–≤–ª–µ–Ω)
**–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è: `adminDeleteUser` (Callable)**

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—ã–∑—ã–≤–∞—é—â–∏–π - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Admin
2. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
3. ‚úÖ –ó–∞–ø—Ä–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å–∞–º–æ–≥–æ —Å–µ–±—è
4. ‚úÖ **–ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –í—Å–µ —Å–º–µ—Ç—ã, –ø—Ä–æ–µ–∫—Ç—ã, –∑–∞–¥–∞—á–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
5. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Firebase Auth
6. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏–∑ Firestore
7. ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
import { getFunctions, httpsCallable } from 'firebase/functions';

const functions = getFunctions();
const adminDeleteUser = httpsCallable(functions, 'adminDeleteUser');

await adminDeleteUser({ userIdToDelete: 'user123' });
```

### 7. Firestore Rules

#### `firestore.rules` (–û–±–Ω–æ–≤–ª–µ–Ω)
**–ù–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

```javascript
match /users/{userId} {
  // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
  function getUserProfile(uid) { ... }
  function requestingUserRole() { ... }
  function requestingUserCompanyId() { ... }

  // –ß–¢–ï–ù–ò–ï:
  // –†–∞–∑—Ä–µ—à–µ–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º —Ç–æ–π –∂–µ –∫–æ–º–ø–∞–Ω–∏–∏
  allow read: if isSignedIn() &&
               requestingUserCompanyId() == targetUserCompanyId();

  // –°–û–ó–î–ê–ù–ò–ï:
  // –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Cloud Function 'onUserCreate'
  allow create: if false;

  // –û–ë–ù–û–í–õ–ï–ù–ò–ï:
  allow update: if
    // –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
    (isOwnProfile() &&
        !request.resource.data.diff(resource.data).affectedKeys()
          .hasAny(['role', 'status', 'companyId']))
    ||
    // –°—Ü–µ–Ω–∞—Ä–∏–π 2: Admin –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª—é–±–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏
    (requestingUserRole() == 'admin' &&
        requestingUserCompanyId() == targetUserCompanyId() &&
        // ...–Ω–æ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–Ω–∏–∑–∏—Ç—å —Å–µ–±–µ —Ä–æ–ª—å
        !(isOwnProfile() && 'role' in request.resource.data.diff(resource.data)));

  // –£–î–ê–õ–ï–ù–ò–ï:
  // –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Cloud Function 'adminDeleteUser'
  allow delete: if false;
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –ø–æ–¥–∫–æ–ª–ª–µ–∫—Ü–∏–π:**
```javascript
function userIsActive(uid) {
  return get(/databases/$(database)/documents/users/$(uid)).data.status == 'active';
}

match /users/{userId}/estimates/{estimateId} {
  allow read, write: if isOwner(userId) && userIsActive(request.auth.uid);
}
```

‚úÖ –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (`status: 'inactive'`) –Ω–µ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏

## üîÑ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ "Last Seen"
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É
2. `AuthContext` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `updateLastSeen()`
3. –ü–æ–ª–µ `lastSeen` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ Firestore
4. –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ "2 –º–∏–Ω—É—Ç—ã –Ω–∞–∑–∞–¥"

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–º–µ–Ω–∞ —Ä–æ–ª–∏ (–ë—ã—Å—Ç—Ä–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ)
1. –ê–¥–º–∏–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `/admin/team`
2. –í–∏–¥–∏—Ç —Ç–∞–±–ª–∏—Ü—É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
3. –ö–ª–∏–∫–∞–µ—Ç –Ω–∞ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ "–†–æ–ª—å" —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
4. –í—ã–±–∏—Ä–∞–µ—Ç "Manager"
5. UI –≤—ã–∑—ã–≤–∞–µ—Ç `updateUserRole()` ‚Üí Firestore –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
6. –°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
1. –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç "–ú–µ–Ω—é" ‚Üí "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è `UserProfileModal`
3. –ê–¥–º–∏–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ Storage)
4. –ò–∑–º–µ–Ω—è–µ—Ç –¥–æ–ª–∂–Ω–æ—Å—Ç—å: "–í–µ–¥—É—â–∏–π —Å–º–µ—Ç—á–∏–∫"
5. –£–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è
6. –ù–∞–∂–∏–º–∞–µ—Ç "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" ‚Üí –í—Å–µ –ø–æ–ª—è –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ Firestore

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
1. –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç "–ú–µ–Ω—é" ‚Üí "–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å"
2. UI –≤—ã–∑—ã–≤–∞–µ—Ç `updateUserStatus(userId, 'inactive')`
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º (Firestore Rules –±–ª–æ–∫–∏—Ä—É—é—Ç)
4. –í —Ç–∞–±–ª–∏—Ü–µ —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "–ù–µ–∞–∫—Ç–∏–≤–µ–Ω"

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–û–ø–∞—Å–Ω–æ!)
1. –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç "–ú–µ–Ω—é" ‚Üí "–£–¥–∞–ª–∏—Ç—å"
2. –ü–æ—è–≤–ª—è–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
   ```
   "–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ –∏ —É–¥–∞–ª–∏—Ç –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
   –í—Å–µ –µ–≥–æ —Å–º–µ—Ç—ã –∏ –ø—Ä–æ–µ–∫—Ç—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–Ω—ã –≤–∞–º."
   ```
3. –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç "–£–¥–∞–ª–∏—Ç—å"
4. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è Cloud Function `adminDeleteUser`:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞
   - –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
   - –£–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Auth
   - –£–¥–∞–ª—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ Firestore
5. –°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install date-fns
```

**date-fns** - –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç ("2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥", "–≤—á–µ—Ä–∞" –∏ —Ç.–¥.)

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Cloud Functions

```bash
cd functions
npm install
cd ..

# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é adminDeleteUser
firebase deploy --only functions:adminDeleteUser
```

### –®–∞–≥ 2: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Firestore Rules

```bash
# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
firebase deploy --only firestore:rules
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ Storage Rules

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `storage.rules` —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–æ–≤:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // –ê–≤–∞—Ç–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    match /avatars/{userId}/{fileName} {
      allow read: if true; // –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–≤–∞—Ç–∞—Ä–∞–º
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å:
```bash
firebase deploy --only storage
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è lastSeen
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ Firestore Console
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª–µ `lastSeen` –æ–±–Ω–æ–≤–∏–ª–æ—Å—å

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π (Admin)
1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é Admin
2. –û—Ç–∫—Ä–æ–π—Ç–µ `/admin/team`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ª–∏ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∫–æ–º–ø–∞–Ω–∏–∏
   - –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–º–µ–Ω–∞ —Ä–æ–ª–∏
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Firestore Rules
1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é `estimator`
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å
3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Permission Denied
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç Admin ‚Üí –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Cloud Function (–ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è)
1. –í—ã–∑–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —á–µ—Ä–µ–∑ –∫–æ–¥:
```typescript
const result = await adminDeleteUser({ userIdToDelete: 'testUserId' });
console.log(result);
```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Firebase Console
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω—ã

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
1. **Firestore Rules**: –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª–∏ —Å–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
2. **Cloud Function Validation**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–æ–º–ø–∞–Ω–∏–∏
3. **–ó–∞–ø—Ä–µ—Ç —Å–∞–º–æ—É–¥–∞–ª–µ–Ω–∏—è**: –ê–¥–º–∏–Ω –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
4. **–ó–∞–ø—Ä–µ—Ç –ø–æ–Ω–∏–∂–µ–Ω–∏—è —Ä–æ–ª–∏ —Å–µ–±–µ**: –ê–¥–º–∏–Ω –Ω–µ –º–æ–∂–µ—Ç –ø–æ–Ω–∏–∑–∏—Ç—å —Å–µ–±–µ —Ä–æ–ª—å
5. **–°—Ç–∞—Ç—É—Å inactive**: –ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º
6. **–°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Cloud Functions**: –ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –Ω–∞–ø—Ä—è–º—É—é

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ê–¥–º–∏–Ω **–º–æ–∂–µ—Ç** –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –¥—Ä—É–≥–æ–≥–æ –∞–¥–º–∏–Ω–∞ (–µ—Å–ª–∏ –≤ –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏)
- –ê–¥–º–∏–Ω **–º–æ–∂–µ—Ç** –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –∞–¥–º–∏–Ω–∞
- **–†–µ—à–µ–Ω–∏–µ**: –í production –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É "–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–¥–º–∏–Ω–∞" (–¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è –º–∏–Ω–∏–º—É–º 1 Admin –≤ –∫–æ–º–ø–∞–Ω–∏–∏)

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ user.types.ts                    # UserProfile, UserStatus
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ userApi.ts                        # –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
‚îÇ   ‚îî‚îÄ‚îÄ userManagementApi.ts              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (Admin)
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.tsx                   # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ lastSeen
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ       ‚îî‚îÄ‚îÄ UserProfileModal.tsx          # –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ       ‚îî‚îÄ‚îÄ TeamAdminPage.tsx             # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π
‚îî‚îÄ‚îÄ router/
    ‚îî‚îÄ‚îÄ AppRouter.tsx                     # –†–æ—É—Ç /admin/team

functions/
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ index.ts                          # Cloud Function adminDeleteUser

firestore.rules                            # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

## ‚ú® –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### TODO: –§—É–Ω–∫—Ü–∏–∏, –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º –º–æ–¥—É–ª–µ:

1. **–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**:
   - –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞" –ø–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç alert
   - –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:
     - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–æ—Ä–º–æ–π email + role
     - Cloud Function `inviteUser` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
     - Email templates –≤ Firebase

2. **–ó–∞—â–∏—Ç–∞ "–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–¥–º–∏–Ω–∞"**:
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: –≤ –∫–æ–º–ø–∞–Ω–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 1 Admin
   - –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—é/—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–¥–º–∏–Ω–∞

3. **–ê—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π**:
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–µ–π/—Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø—Ä–æ—Ñ–∏–ª–µ

4. **Batch –æ–ø–µ—Ä–∞—Ü–∏–∏**:
   - –ú–∞—Å—Å–æ–≤–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ú–∞—Å—Å–æ–≤–∞—è —Å–º–µ–Ω–∞ —Ä–æ–ª–µ–π

5. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã**:
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–æ–ª–∏
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
   - –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/email

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (lastSeen)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –∞–≤–∞—Ç–∞—Ä–æ–≤
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ —Ä–æ–ª–µ–π
- ‚úÖ –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ "—É–¥–∞–ª–µ–Ω–∏–µ")
- ‚úÖ –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö (Cloud Function)
- ‚úÖ Firestore Rules —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞**: http://localhost:3001

**–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞**: http://localhost:3001/admin/team

---

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é `admin`
2. –ù–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ç–æ–π –∂–µ `companyId`
3. Firebase Project –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç
